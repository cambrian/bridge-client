"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const core_1 = require("@most/core");
function hold(stream) {
    return new Hold(stream);
}
exports.hold = hold;
class Hold extends core_1.MulticastSource {
    constructor(source) {
        super(source);
        this.closed = false;
        this.heldValue = undefined;
    }
    run(sink, scheduler) {
        let time = scheduler.currentTime();
        this.tryFlushLatest(sink, time);
        if (this.closed)
            sink.end(time);
        return super.run(sink, scheduler);
    }
    event(time, value) {
        this.heldValue = value;
        super.event(time, value);
    }
    tryFlushLatest(sink, time) {
        if (this.heldValue)
            tryEvent(time, this.heldValue, sink);
    }
    end(time) {
        this.closed = true;
        this.sinks.forEach(sink => sink.end(time));
    }
}
function tryEvent(t, x, sink) {
    try {
        sink.event(t, x);
    }
    catch (e) {
        sink.error(t, e);
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaG9sZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9zdHJlYW1zL2hvbGQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFHQSxxQ0FBNEM7QUFFNUMsU0FBZ0IsSUFBSSxDQUFLLE1BQWlCO0lBQ3hDLE9BQU8sSUFBSSxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUE7QUFDekIsQ0FBQztBQUZELG9CQUVDO0FBRUQsTUFBTSxJQUFRLFNBQVEsc0JBQWtCO0lBSXRDLFlBQWEsTUFBaUI7UUFDNUIsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFBO1FBQ2IsSUFBSSxDQUFDLE1BQU0sR0FBRyxLQUFLLENBQUE7UUFDbkIsSUFBSSxDQUFDLFNBQVMsR0FBRyxTQUFTLENBQUE7SUFDNUIsQ0FBQztJQUVELEdBQUcsQ0FBRSxJQUFhLEVBQUUsU0FBb0I7UUFDdEMsSUFBSSxJQUFJLEdBQUcsU0FBUyxDQUFDLFdBQVcsRUFBRSxDQUFBO1FBQ2xDLElBQUksQ0FBQyxjQUFjLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxDQUFBO1FBQy9CLElBQUksSUFBSSxDQUFDLE1BQU07WUFBRSxJQUFJLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFBO1FBQy9CLE9BQU8sS0FBSyxDQUFDLEdBQUcsQ0FBQyxJQUFJLEVBQUUsU0FBUyxDQUFDLENBQUE7SUFDbkMsQ0FBQztJQUVELEtBQUssQ0FBRSxJQUFVLEVBQUUsS0FBUTtRQUN6QixJQUFJLENBQUMsU0FBUyxHQUFHLEtBQUssQ0FBQTtRQUN0QixLQUFLLENBQUMsS0FBSyxDQUFDLElBQUksRUFBRSxLQUFLLENBQUMsQ0FBQTtJQUMxQixDQUFDO0lBRUQsY0FBYyxDQUFFLElBQWEsRUFBRSxJQUFVO1FBQ3ZDLElBQUksSUFBSSxDQUFDLFNBQVM7WUFBRSxRQUFRLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxTQUFTLEVBQUUsSUFBSSxDQUFDLENBQUE7SUFDMUQsQ0FBQztJQUVELEdBQUcsQ0FBRSxJQUFVO1FBQ2IsSUFBSSxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUE7UUFDbEIsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUE7SUFDNUMsQ0FBQztDQUNGO0FBRUQsU0FBUyxRQUFRLENBQUssQ0FBTyxFQUFFLENBQUksRUFBRSxJQUFhO0lBQ2hELElBQUk7UUFDRixJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQTtLQUNqQjtJQUFDLE9BQU8sQ0FBQyxFQUFFO1FBQ1YsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUE7S0FDakI7QUFDSCxDQUFDIn0=